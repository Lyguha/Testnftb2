local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local autoFarmEnabled = true
local currentMoney = 0

-- Получаем ссылки на необходимые объекты игры
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Функция для получения текущего количества денег из игры
local function getMoney()
    local success, result = pcall(function()
        -- Получаем значение денег из _StarsValue
        local starsValue = LocalPlayer:WaitForChild("_StarsValue")
        return starsValue.Value
    end)
    
    if success then
        return result
    else
        -- Если произошла ошибка, возвращаем последнее известное значение
        warn("Ошибка при получении денег: " .. tostring(result))
        return currentMoney
    end
end

-- Функция для определения, какой кейс открывать
local function getCaseToOpen()
    local money = getMoney()
    
     if money >= 2700000 then
        return "Dream"
    elseif money >= 1400000 then
        return "Glitch"
    elseif money >= 1250000 then
        return "Luxury"
    elseif money >= 390000 then
        return "Burj"
    elseif money >= 145000 then
        return "Palm"
    elseif money >= 55000 then
        return "Dark"
    elseif money >= 21000 then
        return "Gold"
    elseif money >= 15000 then
        return "Oligarch"
    elseif money >= 7000 then
        return "Office Clerk"
    elseif money >= 2500 then
        return "Beggar"
    else
        return "Trash"
    end
end

-- Функция для продажи всех предметов
local function sellAllItems()
    local success, errorMsg = pcall(function()
        local args = {
            "Sell",
            "ALL"
        }
        game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Inventory"):FireServer(unpack(args))
    end)
    
    if success then
        print("Успешно проданы все предметы")
    else
        warn("Ошибка при продаже предметов: " .. tostring(errorMsg))
    end
    return success
end

-- Функция автоматического фарма
local function autoFarmCases()
    while autoFarmEnabled do
        local caseType = getCaseToOpen()
        
        -- Открываем кейс
        local openSuccess, openError = pcall(function()
            local args = {
                caseType,
                10
            }
            game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("OpenCase"):InvokeServer(unpack(args))
        end)
        
        if openSuccess then
            print("Успешно открыт кейс: " .. caseType)
            
            -- Ждем немного перед продажей
            wait(0.5)
            
            -- Продаем все предметы из кейса
            sellAllItems()
            
        else
            warn("Ошибка при открытии кейса: " .. tostring(openError))
        end
        
        -- Обновляем счетчик денег
        currentMoney = getMoney()
        
        -- Ждем перед следующей итерацией
        wait(1)
    end
end

local Window = Rayfield:CreateWindow({
   Name = "Автофарм кейсов",
   LoadingTitle = "Автофарм кейсов",
   LoadingSubtitle = "by Sirius",
   Theme = "Default",
   ToggleUIKeybind = "K"
})

local Tab = Window:CreateTab("Авто Фарм", "settings")

-- Добавляем элементы в вкладку Авто Фарм
local Label = Tab:CreateLabel("Система автоматически выбирает кейс по деньгам:")
local Label = Tab:CreateLabel("• < 2.5K: Trash")
local Label = Tab:CreateLabel("• ≥ 2.5K: Beggar")
local Label = Tab:CreateLabel("• ≥ 7K: Office Clerk")
local Label = Tab:CreateLabel("• ≥ 15K: Oligarch")
local Label = Tab:CreateLabel("• ≥ 21K: Gold")
local Label = Tab:CreateLabel("• ≥ 55K: Dark")
local Label = Tab:CreateLabel("• ≥ 145K: Palm")
local Label = Tab:CreateLabel("• ≥ 390K: Burj")
local Label = Tab:CreateLabel("• ≥ 1.25M: Luxury")
local Label = Tab:CreateLabel("• ≥ 1.4M: Glitch")
local Label = Tab:CreateLabel("• ≥ 2.7M: Dream")

local CurrentMoneyLabel = Tab:CreateLabel("Текущие деньги: 0")

-- Функция для обновления отображения денег
local function updateMoneyDisplay()
    currentMoney = getMoney()
    CurrentMoneyLabel:Set("Текущие деньги: " .. tostring(currentMoney))
end

-- Кнопка запуска автофарма
local ToggleButton = Tab:CreateToggle({
    Name = "Авто Фарм кейсов",
    CurrentValue = false,
    Flag = "AutoFarmToggle",
    Callback = function(Value)
        autoFarmEnabled = Value
        if Value then
            Rayfield:Notify({
                Title = "Автофарм запущен",
                Content = "Система автоматически открывает кейсы и продает предметы",
                Duration = 3,
                Image = "✓",
            })
            -- Запускаем автофарм в отдельной корутине
            coroutine.wrap(autoFarmCases)()
        else
            Rayfield:Notify({
                Title = "Автофарм остановлен",
                Content = "Автоматический фарм отключен",
                Duration = 3,
                Image = "✗",
            })
        end
    end,
})

-- Кнопка для обновления баланса денег
local Button = Tab:CreateButton({
    Name = "Обновить баланс",
    Callback = function()
        updateMoneyDisplay()
        Rayfield:Notify({
            Title = "Баланс обновлен",
            Content = "Текущие деньги: " .. tostring(currentMoney),
            Duration = 3,
            Image = "✓",
        })
    end,
})

-- Кнопка для ручной продажи всех предметов
local Button = Tab:CreateButton({
    Name = "Продать все предметы сейчас",
    Callback = function()
        local success = sellAllItems()
        if success then
            Rayfield:Notify({
                Title = "Продажа завершена",
                Content = "Все предметы успешно проданы",
                Duration = 3,
                Image = "✓",
            })
        else
            Rayfield:Notify({
                Title = "Ошибка продажи",
                Content = "Не удалось продать предметы",
                Duration = 3,
                Image = "✗",
            })
        end
    end,
})

-- Автоматическое обновление отображения денег
coroutine.wrap(function()
    while true do
        updateMoneyDisplay()
        wait(2) -- Обновляем каждые 2 секунды
    end
end)()
