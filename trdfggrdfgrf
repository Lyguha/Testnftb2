local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local auto = 0
local autoFarmEnabled = true
local currentMoney = 0
local autoStartEnabled = true -- true = автофарм включится автоматически, false = отключено

-- Получаем ссылки на необходимые объекты игры
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Функция для получения текущего количества денег из игры
local function getMoney()
    local success, result = pcall(function()
        -- Получаем значение денег из _StarsValue
        local starsValue = LocalPlayer:WaitForChild("_StarsValue")
        return starsValue.Value
    end)
    
    if success then
        return result
    else
        -- Если произошла ошибка, возвращаем последнее известное значение
        warn("Ошибка при получении денег: " .. tostring(result))
        return currentMoney
    end
end

-- Функция для определения, какой кейс открывать
local function getCaseToOpen()
    local money = getMoney()
    
     if money >= 5100000 then
        return "Bloody Night"
    elseif money >= 21000 then
        return "Gold"
    elseif money >= 15000 then
        return "Oligarch"
    elseif money >= 7000 then
        return "Office Clerk"
    elseif money >= 2500 then
        return "Beggar"
    else
        return "Trash"
    end
end

-- Функция для продажи всех предметов
local function sellAllItems()
    local success, errorMsg = pcall(function()
        local args = {
            "Sell",
            "ALL"
        }
        game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Inventory"):FireServer(unpack(args))
    end)
    
    if success then
        print("Успешно проданы все предметы")
    else
        warn("Ошибка при продаже предметов: " .. tostring(errorMsg))
    end
    return success
end

-- Функция для продажи всех подарков
local function sellAllGifts()
    local success, errorMsg = pcall(function()
        local args = {
            "Sell",
            "ALL"
        }
        -- Предполагаем, что для подарков используется тот же ивент, но с другим типом
        -- Если в игре отдельный ивент для подарков, нужно его указать
        game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Inventory"):FireServer(unpack(args))
    end)
    
    if success then
        print("Успешно проданы все подарки")
    else
        warn("Ошибка при продаже подарков: " .. tostring(errorMsg))
    end
    return success
end

-- Функция автоматического фарма
local function autoFarmCases()
    while autoFarmEnabled do
        local caseType = getCaseToOpen()
        
        -- Открываем кейс
        local openSuccess, openError = pcall(function()
            local args = {
                caseType,
                10
            }
            game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("OpenCase"):InvokeServer(unpack(args))
        end)
        
        if openSuccess then
            print("Успешно открыт кейс: " .. caseType)
            
            -- Ждем немного перед продажей
            wait(0.5)
            
            -- Продаем все предметы из кейса
            sellAllItems()
            
            -- Ждем еще немного
            wait(0.5)
            
            -- Продаем все подарки (если они есть)
            sellAllGifts()
            
        else
            warn("Ошибка при открытии кейса: " .. tostring(openError))
        end
        
        -- Обновляем счетчик итераций
        auto += 1
        
        -- Обновляем счетчик денег
        currentMoney = getMoney()
        
        -- Ждем перед следующей итерацией
        wait(1)
    end
end

local Window = Rayfield:CreateWindow({
   Name = "Автофарм кейсов",
   Icon = 0,
   LoadingTitle = "не мой гуи",
   LoadingSubtitle = "by Sirius",
   ShowText = "Автофарм Trash кейсов",
   Theme = "Default",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,
   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "Big Hub"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },
   KeySystem = false
})

local Tab2 = Window:CreateTab("Info", "book-text")
local Tab4 = Window:CreateTab("Halloween", "banknote")
local Tab = Window:CreateTab("Trash", "banknote")
local Tab3 = Window:CreateTab("Beggar", "banknote")
local Tab5 = Window:CreateTab("Plodder", "banknote")
local Tab6 = Window:CreateTab("Office Clerk", "banknote")
local Tab7 = Window:CreateTab("Manager", "banknote")
local Tab8 = Window:CreateTab("Авто Фарм", "settings")
local Tab1 = Window:CreateTab("Credits", "creative-commons")

-- Добавляем элементы в вкладку Авто Фарм
local Label = Tab8:CreateLabel("Система автоматически выбирает кейс по деньгам:")
local Label = Tab8:CreateLabel("• < 2.5K: Trash")
local Label = Tab8:CreateLabel("• ≥ 2.5K: Beggar")
local Label = Tab8:CreateLabel("• ≥ 7K: Office Clerk")
local Label = Tab8:CreateLabel("• ≥ 15K: Oligarch")
local Label = Tab8:CreateLabel("• ≥ 21K: Gold")
local Label = Tab8:CreateLabel("• ≥ 5.1M: Bloody Night")

local CurrentMoneyLabel = Tab8:CreateLabel("Текущие деньги: 0")

-- Функция для обновления отображения денег
local function updateMoneyDisplay()
    currentMoney = getMoney()
    CurrentMoneyLabel:Set("Текущие деньги: " .. tostring(currentMoney))
end

-- Переключатель автоматического запуска
local AutoStartToggle = Tab8:CreateToggle({
    Name = "Автозапуск автофарма при включении",
    CurrentValue = autoStartEnabled,
    Flag = "AutoStartToggle",
    Callback = function(Value)
        autoStartEnabled = Value
        if Value then
            Rayfield:Notify({
                Title = "Автозапуск включен",
                Content = "Автофарм будет автоматически запускаться при включении GUI",
                Duration = 3,
                Image = "✓",
            })
        else
            Rayfield:Notify({
                Title = "Автозапуск отключен",
                Content = "Автофарм не будет запускаться автоматически",
                Duration = 3,
                Image = "✗",
            })
        end
    end,
})

-- Кнопка запуска автофарма
local ToggleButton = Tab8:CreateToggle({
    Name = "Авто Фарм кейсов",
    CurrentValue = false,
    Flag = "AutoFarmToggle",
    Callback = function(Value)
        autoFarmEnabled = Value
        if Value then
            Rayfield:Notify({
                Title = "Автофарм запущен",
                Content = "Система автоматически открывает кейсы и продает подарки",
                Duration = 3,
                Image = "✓",
            })
            -- Запускаем автофарм в отдельной корутине
            coroutine.wrap(autoFarmCases)()
        else
            Rayfield:Notify({
                Title = "Автофарм остановлен",
                Content = "Автоматический фарм отключен",
                Duration = 3,
                Image = "✗",
            })
        end
    end,
})

-- Кнопка для обновления баланса денег
local Button = Tab8:CreateButton({
    Name = "Обновить баланс",
    Callback = function()
        updateMoneyDisplay()
        Rayfield:Notify({
            Title = "Баланс обновлен",
            Content = "Текущие деньги: " .. tostring(currentMoney),
            Duration = 3,
            Image = "✓",
        })
    end,
})

-- Кнопка для ручной продажи всех предметов
local Button = Tab8:CreateButton({
    Name = "Продать все предметы сейчас",
    Callback = function()
        local success = sellAllItems()
        if success then
            Rayfield:Notify({
                Title = "Продажа завершена",
                Content = "Все предметы успешно проданы",
                Duration = 3,
                Image = "✓",
            })
        else
            Rayfield:Notify({
                Title = "Ошибка продажи",
                Content = "Не удалось продать предметы",
                Duration = 3,
                Image = "✗",
            })
        end
    end,
})

-- Кнопка для ручной установки денег (для тестирования)
local Input = Tab8:CreateInput({
    Name = "Установить деньги (тест)",
    PlaceholderText = "Введите сумму",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        currentMoney = tonumber(Text) or 0
        updateMoneyDisplay()
        Rayfield:Notify({
            Title = "Деньги установлены",
            Content = "Установлено: " .. tostring(currentMoney),
            Duration = 3,
            Image = "✓",
        })
    end,
})

-- Остальной код вкладок остается без изменений
local Label = Tab1:CreateLabel("Кодер: Авед")
local Label = Tab1:CreateLabel("Тестер: Авед, Дэмэнтый")
local Label = Tab1:CreateLabel("Гуи: Sirius")
local Label = Tab1:CreateLabel("Мария: Зайцева")
local Label = Tab2:CreateLabel("Тестировал на: Delta(android)")
local Label = Tab2:CreateLabel("Тестировал на: Seliware(desktop)")
local Label = Tab2:CreateLabel("Это open source проект")
local Label = Tab2:CreateLabel("Донатов нету, разраб хороший прост")
local Label = Tab2:CreateLabel("Ксено и соляра юзеры пидорасы")

Rayfield:Notify({
   Title = "ВНИМАНИЕ",
   Content = "На телефонах возможны баги",
   Duration = 6.5,
   Image = "x",
})

-- Функция для автоматического запуска автофарма
local function autoStartFarm()
    if autoStartEnabled then
        wait(2) -- Ждем немного после загрузки GUI
        autoFarmEnabled = true
        ToggleButton:Set(true)
        Rayfield:Notify({
            Title = "Автофарм запущен автоматически",
            Content = "Автофарм был автоматически включен",
            Duration = 5,
            Image = "⚡",
        })
        coroutine.wrap(autoFarmCases)()
    end
end

-- Запускаем автоматический старт если включено
coroutine.wrap(autoStartFarm)()

-- Автоматическое обновление отображения денег
coroutine.wrap(function()
    while true do
        updateMoneyDisplay()
        wait(2) -- Обновляем каждые 2 секунды
    end
end)()

-- Ваш существующий код для ручного фарма
local Button = Tab:CreateButton({
   Name = "Фарм 1МЛН кейсов",
   Callback = function()
   while true do
    local args = {
    "Trash",
    10
  }
  game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("OpenCase"):InvokeServer(unpack(args))
    local args = {
    "Sell",
    "ALL"
  }
  game:GetService("ReplicatedStorage"):WaitForChild("Events"):WaitForChild("Inventory"):FireServer(unpack(args))
  wait(1)
  auto += 1
  
  if auto == 100000 then
    auto = 0
    break
  end
end
   end,
})

local Button = Tab2:CreateButton({
   Name = "Полностью закрыть GUI",
   Callback = function()
   Rayfield:Destroy()
   end,
})
